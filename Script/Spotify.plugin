#!name = è§£é”&ç¿»è¯‘&å»å¹¿å‘Š
#!desc = å°†Spotifyçš„å¤–è¯­æ­Œè¯ç¿»è¯‘ä¸ºç®€ä½“ä¸­æ–‡& è§£é”VIPï¼Œå»é™¤éƒ¨åˆ†å¹¿å‘Šã€‚æ³¨æ„ï¼šéŸ³è´¨åªèƒ½è®¾ç½®ä¸ºé«˜ï¼è¶…é«˜å¯èƒ½æ— æ³•æ’­æ”¾
#!openUrl = 
#!author =app2smile[https://DualSubs.github.io/guide/spotify]
#!homepage = https://github.com/zz12300/banyun/tree/main/Script/Spotify.plugin
#!icon = https://github.com/Moli-X/Resources/raw/main/Icon/Image/Spotify.png
#!Edit = 

# åŸé“¾æ¥ï¼šhttps://raw.githubusercontent.com/app2smile/rules/master/plugin/spotify.plugin
# åŸé“¾æ¥: https://github.com/DualSubs/Spotify/releases/latest/download/DualSubs.Spotify.plugin
# åŸé“¾æ¥ï¼šhttps://DualSubs.github.io/guide/spotify

[Argument]
Types = input,"Translate,External",tag=[æ­Œè¯] å¯ç”¨ç±»å‹ï¼ˆå¤šé€‰ï¼‰,desc=è¯·é€‰æ‹©è¦æ·»åŠ çš„æ­Œè¯é€‰é¡¹ï¼Œå¦‚æœä¸ºå¤šé€‰ï¼Œåˆ™ä¼šè‡ªåŠ¨å†³å®šæä¾›çš„æ­Œè¯ç±»å‹ã€‚
Languages[0] = select,"AUTO","ZH","ZH-HANS","ZH-HK","ZH-HANT","EN","ES","JA","KO","DE","FR","TR","KM",tag=[ç¿»è¯‘æ­Œè¯] ä¸»è¯­è¨€ï¼ˆæºè¯­è¨€ï¼‰,desc=ä»…å½“æºè¯­è¨€è¯†åˆ«ä¸å‡†ç¡®æ—¶æ›´æ”¹æ­¤é€‰é¡¹ã€‚
Languages[1] = select,"ZH","ZH-HANS","ZH-HK","ZH-HANT","EN","EN-US","ES","ES-ES","ES-419","JA","KO","DE","FR","TR","KM",tag=[ç¿»è¯‘æ­Œè¯] å‰¯è¯­è¨€ï¼ˆç›®æ ‡è¯­è¨€ï¼‰,desc=è¯·æŒ‡å®šç¿»è¯‘æ­Œè¯çš„ç›®æ ‡è¯­è¨€ã€‚
Vendor = select,"Google","Microsoft",tag=[ç¿»è¯‘å™¨] æœåŠ¡å•†API,desc=è¯·é€‰æ‹©ç¿»è¯‘å™¨æ‰€ä½¿ç”¨çš„æœåŠ¡å•†APIï¼Œæ›´å¤šç¿»è¯‘é€‰é¡¹è¯·ä½¿ç”¨BoxJsã€‚
LrcVendor = select,"NeteaseMusic","QQMusic","NeteaseMusicNodeJS",tag=[æ­Œè¯] æœåŠ¡å•†API,desc=è¯·é€‰æ‹©å¤–éƒ¨æºæ‰€ä½¿ç”¨çš„æœåŠ¡å•†APIã€‚

[Rule]
AND,((DOMAIN, spclient.wg.spotify.com), (PROTOCOL, QUIC)),REJECT

[Rewrite]
^https:\/\/spclient\.wg\.spotify\.com\/user-customization-service\/v1\/customize$ header-del if-none-match
^https:\/\/spclient\.wg\.spotify\.com\/pendragon\/ reject-dict
^https:\/\/spclient\.wg\.spotify\.com\/(artistview\/v1\/artist|album-entity-view\/v2\/album)\/(.*)platform=iphone header https://spclient.wg.spotify.com/$1/$2platform=ipad

[Script]
#å»é™¤æ’­æ”¾å¹¿å‘Š
http-request ^https:\/\/spclient\.wg\.spotify\.com\/(artistview\/v1\/artist|album-entity-view\/v2\/album)\/ script-path=https://raw.githubusercontent.com/app2smile/rules/master/js/spotify-json.js, timeout=10, tag=spotifyJson
http-response ^https:\/\/spclient\.wg\.spotify\.com\/(bootstrap\/v1\/bootstrap|user-customization-service\/v1\/customize)$ script-path=https://raw.githubusercontent.com/app2smile/rules/master/js/spotify-proto.js, requires-body=true, binary-body-mode=true, timeout=10, tag=spotifyProto

#æ­Œè¯æ˜¾ç¤º
http-response ^https?:\/\/api\.spotify\.com\/v1\/tracks\? script-path=https://github.com/DualSubs/Spotify/releases/download/v1.9.9/response.bundle.js, requires-body=true, tag=ğŸ¿ï¸ DualSubs.Spotify.Tracks.response.json, argument="[{Types},{Languages[0]},{Languages[1]},{Vendor},{LrcVendor},{LogLevel}]"

http-request ^https?:\/\/spclient\.wg\.spotify\.com\/color-lyrics\/v2\/track\/(.+)\?(.*)format=json script-path=https://github.com/DualSubs/Spotify/releases/download/v1.9.9/request.bundle.js, requires-body=true, tag=ğŸ¿ï¸ DualSubs.Spotify.Lyrics.request.json, argument="[{Types},{Languages[0]},{Languages[1]},{Vendor},{LrcVendor},{LogLevel}]"

http-request ^https?:\/\/spclient\.wg\.spotify\.com\/color-lyrics\/v2\/track\/\w+\?(.*) script-path=https://github.com/DualSubs/Spotify/releases/download/v1.9.9/request.bundle.js, requires-body=true, binary-body-mode=true, tag=ğŸ¿ï¸ DualSubs.Spotify.Lyrics.request.proto, argument="[{Types},{Languages[0]},{Languages[1]},{Vendor},{LrcVendor},{LogLevel}]"

http-response ^https?:\/\/spclient\.wg\.spotify\.com\/color-lyrics\/v2\/track\/(.+)\?(.*)format=json(.*)subtype=Translate script-path=https://github.com/DualSubs/Universal/releases/latest/download/Translate.response.bundle.js, requires-body=true, tag=ğŸ¿ï¸ DualSubs.Spotify.Translate.Lyrics.response.json, argument="[{Types},{Languages[0]},{Languages[1]},{Vendor},{LrcVendor},{LogLevel}]"

http-response ^https?:\/\/spclient\.wg\.spotify\.com\/color-lyrics\/v2\/track\/\w+\?(.*)subtype=Translate script-path=https://github.com/DualSubs/Universal/releases/latest/download/Translate.response.bundle.js, requires-body=true, binary-body-mode=true, tag=ğŸ¿ï¸ DualSubs.Spotify.Translate.Lyrics.response.proto, argument="[{Types},{Languages[0]},{Languages[1]},{Vendor},{LrcVendor},{LogLevel}]"

http-response ^https?:\/\/spclient\.wg\.spotify\.com\/color-lyrics\/v2\/track\/(.+)\?(.*)format=json(.*)subtype=External script-path=https://github.com/DualSubs/Universal/releases/latest/download/External.Lyrics.response.bundle.js, requires-body=true, tag=ğŸ¿ï¸ DualSubs.Spotify.External.Lyrics.response.json, argument="[{Types},{Languages[0]},{Languages[1]},{Vendor},{LrcVendor},{LogLevel}]"

http-response ^https?:\/\/spclient\.wg\.spotify\.com\/color-lyrics\/v2\/track\/\w+\?(.*)subtype=External script-path=https://github.com/DualSubs/Universal/releases/latest/download/External.Lyrics.response.bundle.js, requires-body=true, binary-body-mode=true, tag=ğŸ¿ï¸ DualSubs.Spotify.External.Lyrics.response.proto, argument="[{Types},{Languages[0]},{Languages[1]},{Vendor},{LrcVendor},{LogLevel}]"

[MITM]
hostname = api.spotify.com, spclient.wg.spotify.com

